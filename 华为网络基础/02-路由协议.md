# 一、RIP

## Routing Information Protocol  路由信息协议

*   距离矢量路由协议，属于IGP协议
*   用于中小型网络，有ripv1，ripv2版本
*   属于udp，端口后250
*   周期性更新
*   支持水平分割，毒性逆转，触发更新等防环特效



## 工作原理：

*   路由器运行rip后，会发送路由更新请求，收到的路由器或发送自己的rip路由进行响应
*   网络稳定后，会进行周期性更新（30s左右）



## 度量

*   rip使用==跳数==作为度量值来衡量达到目的网络的距离
*   缺省情况下，==直连网络的路由跳数为0==，当路由器发送路由更新时==度量+1==
*   rip规定==超过15跳==不可达





## RIPV1 vs RIPV2

ripv1:

*   是==有类==路由协议，不支持vlsm和CIDR
*   广播
*   不支持认证



ripv2

*   是==无类==路由协议，支持vlsm，支持路由聚合和CIDR
*   组播(==224.0.0.9==)发送报文
*   支持明文==认证==和MD5密文认证





## 配置

~~~bash
rip 1              			#开启rip
	version 2				#版本v2
	network 10.0.0.0        #宣告网络，只需要指定输入接口的主类网络地址，只有处于此网络中的接口才能进行rip的接收和发送
rip metricin 5				#在接收路由时增加度量值
rip metricout 5  			#在发送路由时修改度量值
rip split-horizon			#开启水平分割，默认开启
rip poison-reverse			#开启毒性逆转，默认关闭
undo rip input				#禁止接收rip数据包
undo rip output  			#禁止发送rip数据包
silent0interface g0/0/0		#配置被动接口，只收不发
display rip					#验证rip信息
display rip int g0/0/0 verbose #验证rip接口信息
~~~





# 二、OSPF

## Open Shortest Path First 开放式最短短路径优先

是IETF定义的一种基于链路状态的==内部网关路由协议==

RIP是一种基于距离矢量算法的路由协议，存在收敛慢，容易产生环路，可扩展性差的问题，逐渐被OSPF取代

*   中大型网络运用==最广泛的igp协议==
*   链路状态路由协议
*   无类
*   使用组播 ==224.0.0.5== 和 ==224.0.0.6==
*   收敛快
*   以==开销(cost) 作为度量值==
*   采用==SPF算法==可以有效避免回路
*   ==触发式更新==(每30分钟发送定期更新,被称为链路状态泛洪)
*   区域的设计使得ospf能够支持更大规模的网络
*   通过==lsa的形式==发布路由
*   不支持自动汇总，需要==手动汇总==



## OSPF术语

| 术语           | 解释                                                         |
| -------------- | ------------------------------------------------------------ |
| 区域 Area      | ospf在AS内划分多个区域是以==接口为单位==来划分，每个osp只维护当前区域 |
| 区域id Area ID | 可以表示成一个十进制的数字 如：1，也可以是一个ip：0.0.01     |
| 区域优点       | 尽量减少路由表条目，使拓扑图变化仅影响本区域内部             |



## OSPF区域类型

| 类型       | 解释                                                         |
| ---------- | ------------------------------------------------------------ |
| 骨干区域   | Area 0，核心区域，也叫==传输区域==(负责在不同的非骨干区域之间分发路由信息) |
| 非骨干区域 | 不是Area 0 ，也叫==常规区域==                                |
| PS         | 和==骨干区域相连的非骨干区域==                               |



## OSPF的路由器类型

| 类型 | 解释                                                         |
| ---- | ------------------------------------------------------------ |
| IR   | internal route ==内部路由器==，所有接口属于同一区域          |
| BR   | backbone route ==骨干路由器==，至少有一个接口属于骨干区域    |
| ABR  | area border route ==区域边界路由器== 连接一个或多个区域到骨干局域，至少有一个接口属于骨干区域 |
| ASBR | autonamous system border route ==自治系统边界路由器== 把其他路由协议学习到的路由引入到ospf |
| PS   | 一台路由器可以属于多种类型                                   |



## OSPF工作流程

1.  发现并建立邻居
2.  传播LAS(区别于距离矢量协议的路由表更新)
    1.  ==Link state Advertisement 链路状态宣告（路况信息）==
    2.  链路 路由器接口
    3.  状态 描述接口信息(地址，掩码，开销，网络类型，邻居关系)
3.  将LSA泛洪到区域中的所有OSPF路由器
4.  收集LSA创建==LSDB（链路状态数据库,地图）==
5.  使用==SPF算法==计算到每个目标网络的最短距离，存入路由表中

![image-20200902135511187](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200902135518.png)



## Router ID

*   运算OSPF协议前，必须选取一个RID
*   用来==唯一标识==一台OSPF路由器
*   RID可以手动配置，也可以自动生成

| 规则        | 解释                                                         |
| ----------- | ------------------------------------------------------------ |
| rid选取规则 | 1. 手动配置 2.活动回环接口上选取ip地址最高的  3.活动物理接口上选取ip地址最高的 |
| ps          | rid选举具有==非抢占性==，除非重启ospf进程                    |



## OSPF数据包结构和类型

封装与ip协议之上，==ip协议号89==



![image-20200902141429823](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200902141429.png)



![image-20200902141106579](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200902141106.png)



![image-20200902141133304](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200902141133.png)





## OSPF状态机制

![image-20200902142611742](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200902142611.png)



| 字段     | 解释                              |
| -------- | --------------------------------- |
| down     | 没有收到hello包                   |
| init     | 收到hello包，没有看到自己         |
| two-way  | 收到hello包，看到自己==邻居关系== |
| exstart  | 决定信息交换时路由器的主从关系    |
| exchange | 向邻居发送DD数据包                |
| loading  | LSR和LSU交换                      |
| full     | LSDB同步，==临接关系==            |
| ps       | 只有two-way 和full 是稳定状态     |
|          |                                   |





![image-20200902143011799](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200902143011.png)

![image-20200902143356951](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200902143357.png)



![image-20200902143412372](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200902143412.png)

![image-20200902143423559](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200902143423.png)



![image-20200902143516119](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200902143516.png)



## OSPF建立邻居关系的条件

*   RID唯一

*   Hello/Dead时间间隔一致

*   区域id一致

*   认证一致

*   链路MTU大小一致(华为默认不开启检查)

*   子网掩码一致

*   网络地址一致

*   末梢区域设置一致‘

    

## OSPF网络类型：基于接口



![image-20200903170425842](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200903170425.png)





## OSPF选举DR和BDR

只要是==多路访问==BMA和NBMA网络中，为了==减少邻接关系==的数量，从而==减少数据包交换次数==，最终==节省带宽==，降低对路由器处理能力的压力，==选举DR和BDR==

![image-20200903163556679](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200903163603.png)



![image-20200903170058529](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200903170111.png)



| 名词     | 解释                                                         |
| -------- | ------------------------------------------------------------ |
| DR       | designed router 指定路由器，类似班长                         |
| BDR      | backup dr 备用dr，类似副班长                                 |
| DRothers | 类似普通学生                                                 |
| 关系     | dr bdr drouters 之间都保持邻接关系 full；drouther 之间保持邻居 two-way 关系 |
| 地址     | 224.0.0.6向所有dr 和bdr 发送链路状态更新 224.0.0.5 向所有ospf路由器发送 |
| 选举规则 | 首先比较hello报文中携带的==优先级 0 ~ 255 默认1==  最高的是dr，第二的是bdr；优先级为0不参加选举；具有==非抢占性==；优先级一样比叫rid |

