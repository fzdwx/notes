# OSI

**七层：**

>   应用层

能够产生网络流量，和用户交互的应用程序

>   表示层

加密，压缩，编码 解码

>   会话层

服务器和客户端建立的会话   netstat -nb





>   传输层

可靠传输(==tcp==)需要建立会话，不可靠传输(==udp==)

>   网络层

ip地址编址，选择最佳路径

>   数据链路层

控制网络层与物理层之间的通信

>   物理层

电压，接口标准，比特流传输





# TCP/IP

>   应用层

>   传输层

>   网络层

>   数据链路层

>   物理层









# DNS 

**domain name system**：域名解析

*   建立IP地址与域名之间的映射关系
*   域名和IP地址相互解析

**命令**：

| nslookup            | dns调试工具   |
| ------------------- | ------------- |
| ipconfig/displaydns | 查看dns缓存   |
| ipconfig/flushdns   | 清空dns服务器 |



# 传输层

定义了主机应用层序之间端到端的连通性。传输层中最为常见的两个协议是==TCP==(传输控制歇息)和==UDP==(用户数据包协议)

*   传输层提供==端到端==的连接
*   网络层提供==点到点==的连接

## TCP：

### **三次握手建立连接**

甲：发送SYN(同步位)到乙方

​		发送：seq(同步序列号)= 0

乙：收到SYN，发送SYN和ACK(确认字符)到甲方

​		收到：seq = 0，发送：syn=0，ack=1(收到的seq+载荷长度)

甲：收到SYN和ACK，发送ACK到乙方

​	      收到：seq=0，ack=1，发送：ack=1(seq+载荷长度)

​			![image-20200825182222338](https://gitee.com/likeloveC/picture_bed/raw/master/img/20200825182229.png)

### **四次挥手断开连接**

甲方：发送ACK，FIN(终止位)到乙方

​	发送：seq=544，ack=336，next seq=545

==关闭甲方到乙方的连接==

乙方：接收ACK，FIN，发送ACK

​	接收，发送：seq=336，ack=545，next seq=336

==表示乙方知道甲方关闭了通道连接==

乙方：发送ACK，FIN

​	发送：seq=336，ack=545，next seq=337

==表示乙方要关闭和甲方的连接==

甲方：接收ACK,FIN，发送ACK

​	发送：seq=545，ack=337，next seq =545

==表示甲方知道乙方关闭了连接==

![image-20200825182410091](https://gitee.com/likeloveC/picture_bed/raw/master/img/20200825182410.png)



## udp



# 网络层

## IP



## 	APR：

地址解析协议

![image-20200826133744753](https://gitee.com/likeloveC/picture_bed/raw/master/img/20200826133744.png)

![image-20200826133800858](https://gitee.com/likeloveC/picture_bed/raw/master/img/20200826133800.png)



**arp欺骗：**

地址解析协议是建立在网络中各个主机互相信任的基础上的，它的诞生使得网络能够更加高效的运行，但其本身也存在缺陷：

ARP地址转换表是依赖于计算机中高速缓冲存储器动态更新的，而高速缓冲存储器的更新是受到更新周期的限制的，只保存最近使用的地址的[映射](https://baike.baidu.com/item/映射)关系表项，这使得攻击者有了可乘之机，可以在高速缓冲存储器更新表项之前修改地址转换表，实现攻击。ARP请求为广播形式发送的，网络上的主机可以自主发送ARP应答消息，并且当其他主机收到应答报文时不会检测该报文的真实性就将其记录在本地的MAC地址转换表，这样攻击者就可以向目标主机发送伪ARP应答报文，从而篡改本地的MAC地址表。 [5] ARP欺骗可以导致目标计算机与[网关](https://baike.baidu.com/item/网关)通信失败，更会导致通信[重定向](https://baike.baidu.com/item/重定向)，所有的数据都会通过攻击者的机器，因此存在极大的安全隐患。

**免费arp**：可以检测ip地址是否冲突

**arp不能穿越路由器，不能被转发到其他路由器**





## ICMP 



# 数据链路层

## 	LLC子层

**逻辑链路控制**：和网络层交互，负责识别网络层的协议类型，接收上层的数据包封装成帧，向下传递

​		802.2 LLC/SNAP

## 	MAC子层

**介质访问控制**：负责控制和连接物理层的物理介质，==处理硬件设备的物理寻址==，定义网络拓扑以及数据帧的传递顺序

​		802.3 、802.4、802.5	

![image-20200826091129705](https://gitee.com/likeloveC/picture_bed/raw/master/img/20200826091129.png)

![image-20200826091000682](https://gitee.com/likeloveC/picture_bed/raw/master/img/20200826091007.png)

![](https://gitee.com/likeloveC/picture_bed/raw/master/img/20200826091012.png)



如果接收方(根据接收的帧内容)计算的FCS和发送方计算的FCS(包含在帧中)不相等，则视该帧无效并将其丢弃





# IP地址基础	

IP address

*   在ip网络中，通信节点需要有一个ip地址
*   以点==分十进==制表示，由==32位进制==组成
*   分为==网络位==和==主机位==
    *   网络位：代表IP地址所属的网段
    *   主机位，代表网断上的某个节点
    *   由==子网掩码决定==分界线

**环回网卡**：127.xxx.xxx.xxx



| ==公网地址==     | 用于Internet，向isp付费申请，全球唯一    |
| ---------------- | ---------------------------------------- |
| **==私网地址==** | 用于企业内部，不能用于internet，免费使用 |
| **==地址转换==** | 通过nat技术转换为公网地址                |

![image-20200828085700181](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200828085707.png)

## 子网划分

![image-20200828101645843](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200828101645.png)

**概述**

*   满足不同网络对ip地址的需求
*   实现网络的层次性
*   节省ip
*   默认子网掩码可以进一步划分，成为变长子网掩码



![image-20200828102052386](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200828102052.png)

![image-20200828102143977](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200828102144.png)

## 一个例题

192.168.1.100/29，求网络地址，主机地址，广播地址

方法1：

>   /24，借了5位   2^5=32
>
>   256/32=8 每个网段8个地址
>
>   网络地址：192.168.1.96
>
>   主机地址：192.168.1.97-192.168.1.102
>
>   广播地址：192.168.1.103

方法2：

>   /29 = 11111111 11111111 11111111 11111000
>
>   255.255.255.248
>
>   256-248=8
>
>   块=8，每个网段8个





![image-20200828111843658](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200828111843.png)



# 单播广播组播

![image-20200829075846195](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829075853.png)

## 	1.单播

==Unicast==，发送给单个目标



## 	2.广播

==boradcast==，发送给所有广播域内的所有目标

mac地址：ffffffffff

ip地址：该网断的广播地址(最后一个地址，比如255)



## 	3.组播

==multicast==：发给一组目标

Mac地址：01-00-5e开头

ip地址：d类组播地址 224.239



## 	4.接收规则

![image-20200829081050882](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829081051.png)

*   接收地址包括本卡MAC地址、广播地址和本机所属组播地址
*   网卡丢弃与本卡接收地址不匹配的帧
*   网卡解开与本卡接收 地址匹配的帧，将数据递交给上层处理



## 5.广播域和冲突

![image-20200829081134626](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829081134.png)



所有连集线器的都在一个广播域，一个冲突域

连交换机，连了多少个口就有多少个冲突域，一个广播域

路由器，连了几个就有几个冲突域和广播域



# 一、vrp命令

通用路由平台 Vsersatile route platform

## 1.切换视图

![image-20200829085855250](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829085855.png)

## 2.历史命令	

![image-20200829091231387](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829091231.png)



## 3.修改名字

sysname xxx

## 4.修改时间

![image-20200829091635053](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829091635.png)

## 5.进入提示信息

![image-20200829091810607](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829091810.png)



## 6.配置连接用户

![](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829093741.png)



![image-20200829093829288](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829093829.png)



## 7.用户命令等级

![image-20200829122822070](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829122822.png)

![image-20200829122743422](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829122743.png)



## 8.配置接口ip地址

![image-20200829124242950](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829124243.png)



## 9.状态信息查询

![image-20200829124421238](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829124421.png)



## 10.telent连接

端口是23

![image-20200829132532982](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829132533.png)

>   passwd

![image-20200829132743897](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829132744.png)



>   AAA

![image-20200829133129607](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829133129.png)





>   案例

![](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200829133858.png)





## 11.VRP文件系统

![image-20200830121908188](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830121908.png)

![image-20200830124243199](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830124243.png)



# 二、路由基础

工作内容

![image-20200830133153604](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830133153.png)

## 1.术语

![image-20200830131418278](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830131418.png)



![image-20200830132547813](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830132547.png)



## 2.路由转发过程

![image-20200830132637743](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830132637.png)



## 3.路由选路

![image-20200830132938242](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830132938.png)



## 4.路由表字段

![image-20200830133321881](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830133322.png)



## 5.路由优先级(管理距离)

![image-20200830134136949](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830134137.png)



## 6.等价路由

![image-20200830200025177](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830200025.png)

![image-20200830200112540](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830200112.png)



## 7.最长匹配原则

![image-20200830200319391](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830200319.png)

![image-20200830200327533](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830200327.png)



## 8.路由表形成



![image-20200830201356935](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200830201357.png)



# 三、静态路由

## 1.概述：

*   配置简单，开销小
*   手动配置添加，维护
*   无法根据拓扑图的变化进行动态响应
*   用于组网规模小的
*   动静结合

## 2.配置命令：

==ip route-static  目标网络 子网掩码  下一跳地址/出接口==

*   如果出接口为以太网接口，必须指定吓一跳地址
*   如果接口为串口，可以使用下一跳地址或出接口配置
*   通信是双向的，不要忘记配置返回流量的路由

![image-20200831083705839](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831083705.png)



## 3.配置案例

![image-20200831083741972](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831083742.png)

![image-20200831084147029](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831084147.png)





## 4.负载分担(等价路由)

![image-20200831084217372](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831084217.png)





## 5.主备

*   利用优先级的特性，配置浮动路由
*   在主路由失效的情况下，浮动路由会加入到路由表中并承担数据转发业务
*   在主链路正常的情况下，只有主链路会出现在路由表中

![image-20200831084644108](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831084644.png)



## 6.缺省路由

一种特殊的路由，能匹配所有的目标网络

*   可以通过静态路由配置，也可以通过动态路由发布
*   在路由表中，以到网络==0.0.0.0(掩码0.0.0.0)==的形式出现
*   通常用于==末梢网络==庭上网，企业出口)

配置：

==ip route-static 0.0.0.0 0.0.0.0/0  下一跳地址/出接口==



![image-20200831091847724](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831091847.png)





## 7.回环接口

![image-20200831092140993](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831092141.png)



# 四、动态路由

## 1. 路由协议概述：

*   路由器之间交互信息的一种语言
*   共享路由信息
*   维护路由表，提供最佳转发路径



## 2.路由协议总览

![image-20200831095246729](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831095246.png)



![image-20200831095410029](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831095410.png)





## 3.路由协议分类：

#### 	a.IGP：内部网关协议

**用于一个AS内部交换路由信息，RIP,OSPF,IS-IS**

#### 	b.EGP：外部网关协议

**用于多个AS之间交换路由信息，BGP**

### 	c.AS：

**处于单个管理机制下的网络（企业，电信，移动，联通）**





![image-20200831095830234](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831095830.png)





### 4.根据协议算法分类

DV(距离矢量)：基于距离矢量协议，路由器并不了解网络拓扑接口，RIP,EIGRP



LS(链路状态):基于SPF(最短路径优先)算法，路由器了解完整的网络拓扑接口，OSPF,IS-IS





### 5.根据是否带掩码

![image-20200831101914486](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831101914.png)



### 6.根据业务应用

![image-20200831102639874](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831102640.png)



## 4.路由协议操作规则

*   协议是在接口上运行的
*   只能学习和发布相同的协议已知的路由信息
*   如果不同的路由协议间需要交换路有信息，就需要进行==注入(import)==



## 5.路由器收敛

*   当所有路由表包含相同网络可达性信息
*   网络(路由)进入一个稳定的状态
*   网络在达到收敛前无法正常工作

![image-20200831103654789](https://gitee.com/likeloveC/picture_bed/raw/master/img/8.26/20200831103654.png)





# 